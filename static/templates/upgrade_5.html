{{define "upgrade5"}}
<script>
	$(document).ready(function() {
		$( "#progress_bar" ).load( "ajax?controllerName=progressBar");
	});
</script>
<script src="static/js/index.js"></script>

<script>

	function geoFindMe(){

		if(navigator.geolocation){
			navigator.geolocation.getCurrentPosition(success, error, geo_options);
		}else{
			alert("Geolocation services are not supported by your web browser.");
		}

		function success(position) {
			latitude = position.coords.latitude;
			longitude = position.coords.longitude;
			var altitude = position.coords.altitude;
			var accuracy = position.coords.accuracy;
			console.log('success: '+latitude+','+longitude);
			$('#latitude').val(latitude);
			$('#longitude').val(longitude);
		}

		function error(error) {
			console.log("Unable to retrieve your location due to "+error.code + " : " + error.message);
		};

		var geo_options = {
			enableHighAccuracy: true,
			maximumAge : 30000,
			timeout : 27000
		};
	}

	{{if not .GeolocationLat}}
		var latitude = 39.94887
		var longitude = -75.15005
		geoFindMe()
	{{else}}
		var latitude = {{.GeolocationLat}}
		var longitude = {{.GeolocationLon}}
	{{end}}
	$('#latitude').val(latitude);
	$('#longitude').val(longitude);

</script>

<script>

	$('#save').bind('click', function () {
		$('#alert').css("display", "none");

		var latitude = $('#latitude').val();
		var longitude = $('#longitude').val();
		$.post( 'ajax?controllerName=saveGeolocation', { 'geolocation' : latitude+', '+longitude } ,
				function (data) {
					if (data.error!="0") {
						$('#alert').css("display", "block");
					}
					else {
						fc_navigate('upgrade7');
					}
				}, "JSON");
	});

	$('#show_map').bind('click', function () {

		map_init (latitude, longitude, 'map_canvas', true, true);
		google.maps.event.trigger(map, 'resize');
	});

	$("#main_div input").addClass( "form-control" );
	$("#main_div input").width( 150 );

</script>
<div id="main_div">
	<h1 class="page-header">{{.Lang.upgrade_title}}</h1>
	<ol class="breadcrumb">
		<li><a href="#miningMenu">{{.Lang.mining}}</a></li>
		<li class="active">{{.Lang.upgrade_title}}</li>
	</ol>
	{{template "alertSuccess".}}
	<ul class="nav nav-tabs">
		{{noescape .UpgradeMenu}}
	</ul>

	<h3>{{.Lang.your_location}}</h3>
	<button type="button" class="btn btn-primary" id="show_map">Show map</button><br><br>
	<div id="map_canvas" style="width: 640px; height: 480px; margin-bottom:20px; display:none"></div>
	<input id="latitude" class="input" type="text" placeholder="latitude" value="{{.GeolocationLat}}"><input id="longitude" class="input" type="text" placeholder="longitude" value="{{.GeolocationLon}}">
	<br>
	<button class="btn btn-success" id="save">{{.SaveAndGotoStep}}</button>

	<br><br><br><br><br><br><br>
</div>

{{end}}